<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalação no Linux: Usando GIT</title>
</head>
<body>
    <h1>Instalação no Linux: Usando GIT</h1>
    <hr>
    <p>Depois de instalar o FPC dos repositórios, você pode seguir as instruções nesta página para 
        prosseguir com a instalação do Lazarus-IDE.</p>
        <p>Caso ainda não tenha instalado o FreePascal Compiler(FPC, daqui em diante), então siga este link:</p>
        <p><a href="instalacao_linux_instalador.html">Instalação no Linux: Instalação do FPC a partir dos repositórios</a></p>
        <p>Depois de instalar o FPC dos repositórios, usaremos o git para instalar Lazarus-IDE no HOME do usuário. 
        Instalar o Lazarus-IDE em nossa $HOME é muito bom porque não necessitaremos de permissões especiais
        para aplicar patches ou correções em pacotes instalados ou que instalaremos.</p>
        <p>Antes de prosseguir precisamos fazer um ajuste importante em nosso ambiente Linux, 
        ao executar programas construídos no Lazarus no ambiente Linux pode surgir a seguinte
        mensagem de dependência no terminal:</p>
        <pre>
    Gtk-Message: 00:00:00.000: Failed to load module "pk-gtk-module"
        </pre>    
        <p>O programa executa normalmente, mas essa mensagem ou a falta dessa dependência pode indicar que algum
        aspecto visual não está como deveria ser, para corrigir o problema, execute:</p>
        <p>O programa executa normalmente, mas a falta dessa dependência pode indicar que algum aspecto 
            visual não está como deveria ser, para corrigir o problema, execute:</p>
        <pre>
sudo -i
echo "/usr/lib64/gtk-3.0/modules" > /etc/ld.so.conf.d/pk-gtk.conf
echo "/usr/lib64/gtk-2.0/modules" > /etc/ld.so.conf.d/gtk2.conf
ldconfig
        </pre>
    <p>E a mensagem de dependência no terminal sumirá.</p>
    <p>A maioria dos que estiverem lendo essas instruções irão preferir usar o <strong>Instalador 
    do Lazarus</strong> ou o <strong>fpcupdeluge</strong>. Porém há uma terceira via que funciona 
    para Windows e Linux,a instalação diretamente do código fonte do Lazarus, parece complicado, 
    mas não é se você já baixou ou compilou programas via GIT antes. Há algumas vantagens nisso,
    a versão binária compilada por você mesmo será específica para o seu hardware e portanto 
    mais veloz que a versão do instalador. Será similar ao fpcupdeluge, porém mais econômica
    e rápida porque usaremos o FreePascal(FPC daqui em diante) pré-instalado.</p>
    <p>Como o Lazarus está num repositório GIT, temos outra vantagem>: atualização de versão.</p>
    <p>Siga as instruções abaixo, embora sejam para o Linux, os princípios são os mesmos para Windows.</p>
    <ol>
        <li>Se você instalou o FPC (incluindo os fontes) a partir do repositório oficial, então
        precisamos anotar onde estão os fontes do FPC, execute o comando:<br>
        <pre>rpm -ql fpc-src.noarch</pre>
        Descobrirá e notará que foram instalados em <strong>/usr/share/fpcsrc</strong>, anote este caminho porque precisaremos dele mais tarde.
        </li>
        <li>Apague a pasta <strong>~/.lazarus</strong> se a mesma existir:<br>
        <pre>rm -fR ~/.lazarus</pre></li>
        <li>Ainda no terminal, indique onde deseja que o lazarus seja baixado, por exemplo, 
            se desejar diretamente na raiz de sua $HOME então:
<pre>cd ~
mkdir lazarus
cd lazarus
git clone https://gitlab.com/freepascal.org/lazarus/lazarus.git</pre>
        </li>
        <li>Vamos criar uma pasta ‘configs’ que servirá para armazenar a configuração do Lazarus:
            <pre>mkdir configs</pre>            
        </li>       
        <li>Execute ainda::
            <pre>git branch --all</pre>
            <p>Então será listado todos os branchs existentes no repositório oficial:</p>
    <textarea rows=5 cols=80 disabled>
(...)
remotes/origin/fixes_2_0
remotes/origin/fixes_2_2
(...)    
    </textarea>
    <p>E então escolha um branch das que foram listadas, como exemplo escolharemos a <strong>fixes_2_2</strong> que
        incluirá a 2.2.x mais os fixes, isto é, as correções da série 2.2. Mas se desejar outra, fique a vontade.         
        Para prosseguir com o nosso exemplo usando o <strong>fixes_2_2</strong>:</p>
        <pre>git switch fixes_2_2</pre>
    </li> 
        <li>Finalmente vamos compilar, ainda no terminal execute:
<pre>make clean 
make bigide</pre> 
        (demora um pouco, mas vai compilar tudo)     
       </li> 
       <li>Estamos usando uma pasta com nome de ‘lazarus’ ficando assim ~/lazarus/lazarus, então vamos renomear esta última
        para representar melhor a versão que escolhemos, por exemplo, a 2.2.
<pre>
cd ..
mv lazarus lazarus-2.2
cd lazarus-2.2/</pre>
    </li> 


       <li>Anote onde o Lazarus foi instalado, a saber, <strong>~/lazarus/lazarus-2.2</strong> e depois 
        crie um script bash para ele:
        <pre>gedit ~/.local/bin/lazarus-2.2.sh</pre>
        <p>Cole este conteúdo:</p>
<textarea rows=5 cols=80 disabled>
#!/bin/sh
# lazarus 2.2
cd ~/lazarus/lazarus-2.2
./lazarus --pcp=~/lazarus/lazarus-2.2/configs "$@"
</textarea>
<p>Salve o script acima e depois execute no terminal:</p>
<pre>
    chmod a+x ~/.local/bin/lazarus-2.2.sh
</pre>
        Usamos o nome <strong>lazarus-2.2.sh</strong> quando precisar executar o <strong>lazarus</strong> pelo terminal.
       </li>
       <li>Copie o icone do Lazarus que esta em <strong>~/lazarus/lazarus-2.2/images/icons/lazarus.ico</strong> para:<br> 
        ~/.local/share/icons<br>
        <pre>
cp ~/lazarus/lazarus-2.2/images/icons/lazarus.ico ~/.local/share/icons
        </pre>
       </li>       
       <li>Crie um atalho para ele em sua área de trabalho:
        <pre>gedit ~/.local/share/applications/lazarus-2.2.desktop</pre>
        <p>e então cole as instruções abaixo:</p>
<textarea disabled rows=14 cols=80>
[Desktop Entry]

Version=1.0
Encoding=UTF-8
Type=Application
Icon=lazarus.ico
Path=~/lazarus/lazarus-2.2
Exec=~/lazarus/lazarus-2.2/lazarus --pcp=~/lazarus/lazarus-2.2/configs %f
Name=Lazarus 2.2
GenericName=Lazarus IDE with Free Pascal Compiler
Category=Application;IDE;Development;GUIDesigner;Programming;
Categories=Application;IDE;Development;GUIDesigner;Programming;
Keywords=editor;Pascal;IDE;FreePascal;fpc;Design;Designer;         
</textarea>
        <p>Salve o arquivo, a partir de agora, o Lazarus 2.2 aparecerá no menu de seu sistema
            se procurar pelo nome:</p>
        <p>
            <img src="assets/lazarus_icone_gnome1.png" alt="Icone do Lazarus no ambiente GNOME" width="auto" height="auto"><br>
            A imagem acima é possivel notar que temos nosso Lazarus 2.2, ao lado de uma instalação do fpcupdeluge.            
        </p>
    </li>
        <p> Recomendo que use o menu do seu sistema para executar o Lazarus, mas caso queira fazê-lo pela linha de comando use o script criado:</p>
        <pre>lazarus-2.2.sh</pre>
        <p>Isso garantirá a execução com a opção <strong>--pcp=~/lazarus/lazarus-2.2/configs</strong> e
         evitará lazarus diferenes contaminem configurações diferenes.</p>
    </ol>
    <p>Eventualmente você poderá querer baixar novas versões ou atualizações,
        trata-se dum repositório git então não haverá problemas, sempre que precisar recorra aos comandos:</p>
<pre>git switch <strong>main</strong>
git pull  </pre>
    <p>Onde <strong>main</strong> é o branch atual, mas você pode trocá-lo se preferir e então repita 
     os procedimentos anteriores que culminarão no ‘make bigide' mencionado nos passos anteriores.</p>
    <p>Geralmente, as correções do Lazarus estarão listadas com o nome de branchs com o prefixo‘fixes’,
        então será fácil identificar as atualizações.</p>
    <p><strong>TODO</strong>: Adicionar opções para crosscompiling, da forma como esta acima, os projetos serão 
     compilados apenas para o ambiente do host, isto é, se estiver num amd64 apenas compilará para 64bits.</p>        
</body>
</html>